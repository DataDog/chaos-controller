# Contributing

## Requirements

* [minikube](https://kubernetes.io/docs/tasks/tools/install-minikube/)
* [docker](https://docs.docker.com/install/)
* [go](https://golang.org/doc/install)
* [golangci-lint](https://github.com/golangci/golangci-lint)
* [kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl/)
* [git-lfs](https://github.com/git-lfs/git-lfs/wiki/Installation)

## Testing the controller locally

If you want to test the controller locally (without having to redeploy a new image on a staging cluster), please use the [minikube project](https://kubernetes.io/docs/setup/learning-environment/minikube/) as described below:

* get minukube iso stored on git-lfs
  * `git lfs pull`
* start minikube with containerd engine
  * `make minikube-start`
* build the new image of the controller with your local changes
  * `make docker-build`
* deploy the CRD and the controller on the minikube cluster
  * `make install && make deploy`

If the controller is already deployed, you'll have to remove the running pod for changes to be applied.

**Known issue: the pod preset injecting the fake Datadog statsd environment variable is created at the end of the apply. The preset may not be applied on the chaos controller pod, making it to panic. If it's the case, you have to remove the pod so it's created again with the pod preset."**

The [samples](config/samples) contains sample data which can be used to test your changes.

* [deployment.yaml](config/samples/deployment.yaml) contains a simple container which can be used for testing
* [chaos_v1beta1_disruption.yaml](config/samples/chaos_v1beta1_disruption.yaml) contains a Disrption resource. Feel free to comment out want you don't need.

Both samples can be applied using kubectl: `kubectl apply -f deployment.yaml`.

### Minikube ISO

We need some specific kernel modules to be enabled to do some of the injections. Because some of them were not enabled by default in the ISO, we built a custom one following the [official guide](https://minikube.sigs.k8s.io/docs/contributing/iso/) which is stored in the [minikube/iso] directory.

## Re-generating the CRD manifest

When the API package is changed, the CRD (custom resource definition) must be re-generated. To achieve that, just run the `make manifests` command.

## 3rd-party licenses

3rd-party references and licenses are kept in the [LICENSE-3rdparty.csv](LICENSE-3rdparty.csv) file. This file has been generated by the [tasks/3rdparty.py](tasks/3rdparty.py) script. If any vendor is updated, added or removed, this file must be updated as well.
